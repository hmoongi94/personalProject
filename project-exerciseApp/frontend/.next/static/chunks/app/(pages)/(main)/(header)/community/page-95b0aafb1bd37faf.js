(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[841],{60748:function(e,t,n){Promise.resolve().then(n.bind(n,92517))},92517:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var s=n(3827),o=n(64090);n(59667);var c=n(15074),r=e=>{let{handleRegisterFeed:t}=e;return(0,s.jsx)("nav",{className:"navbar w-11/12",children:(0,s.jsxs)("div",{className:"container",children:[(0,s.jsx)("div",{className:"logo mr-5",children:"Exercise Community"}),(0,s.jsx)(o.Suspense,{fallback:(0,s.jsx)("div",{className:"text-white",children:"Loading..."}),children:(0,s.jsx)(c.default,{placeholder:"검색"})}),(0,s.jsx)("button",{className:"ml-4 bg-blue-500 text-white px-4 py-2 rounded",onClick:t,children:"피드 등록"})]})})},a=n(8792),l=e=>{let{postId:t,isAuthor:n,handleDeletePost:o}=e;return(0,s.jsxs)("div",{className:"w-1/5 h-1/2",children:[n&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.default,{href:"/community/editpost/".concat(t),children:(0,s.jsx)("button",{className:"w-full h-full justify-center items-center flex text-xs bg-blue-500 text-white px-2 py-2 rounded",children:"수정"})},t),(0,s.jsx)("button",{className:"w-full h-full justify-center items-center flex text-xs bg-pink-500 text-white px-2 py-2 rounded",onClick:()=>o(t),children:"삭제"})]}),!n&&(0,s.jsx)("span",{className:"text-xs text-red-500",children:"작성자가 아닙니다"})]})},i=e=>{let{postId:t,postUserId:n,postDate:o,isAuthor:c}=e,r=async e=>{try{if(!window.confirm("정말로 게시물을 삭제하시겠습니까?"))return;if(!(await fetch("http://localhost:3560/community/deletepost/".concat(e),{method:"GET"})).ok)throw Error("게시물을 삭제하는데 실패했습니다.");window.location.reload()}catch(e){console.error("게시물 삭제 중 오류가 발생했습니다:",e)}};return(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("img",{src:"profile/기본프로필사진.webp",alt:"프로필사진",className:"w-12 h-12 rounded-full"}),(0,s.jsxs)("div",{className:"w-3/4 mr-24",children:[(0,s.jsx)("div",{className:"text-sm mt-2",children:n}),(0,s.jsx)("div",{className:"text-sm",children:o})]}),(0,s.jsx)(l,{postId:t,isAuthor:c(n),handleDeletePost:r})]})},d=n(138);n(55768),n(8694);var m=e=>{let{content:t,imgurl:n}=e;return(0,s.jsxs)("div",{className:"border",children:[(0,s.jsx)("div",{className:"",children:t}),(0,s.jsx)("div",{className:"w-full",children:n&&(n.split(",").length>1?(0,s.jsx)(d.Z,{dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,children:n.split(",").map((e,t)=>(0,s.jsx)("div",{className:"w-full h-full",children:(0,s.jsx)("img",{src:"/community/".concat(e),alt:"exerciseCardImage",className:"w-full h-96 object-cover",loading:"eager"})},t))}):(0,s.jsx)("img",{src:"/community/".concat(n),alt:"exerciseCardImage",className:"w-full h-96 object-cover",loading:"eager"}))})]})},u=e=>{let{postId:t,userId:n,likedata:c,postdata:r,likeStatus:a,setLikeStatus:l}=e;(0,o.useEffect)(()=>{let e=(e,t)=>c.filter(t=>t.postId===e).map(e=>e.userId).includes(t);l(s=>({...s,[t]:e(t,n||"")}))},[c,t,l,n]);let i=async()=>{if(n){if(a[t])try{if(!(await fetch("http://localhost:3560/community/deleteLikeData/".concat(t,"/").concat(n),{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw Error("데이터베이스에서 좋아요 정보 삭제에 실패했습니다.");console.log("데이터베이스에서 좋아요 정보를 삭제했습니다."),r.map(e=>(e.postId===t&&(e.likeCount=String(Number(e.likeCount)-1)),e)),l({...a,[t]:!1})}catch(e){console.error("데이터베이스에서 좋아요 정보 삭제 중 오류가 발생했습니다:",e)}else try{if(!(await fetch("http://localhost:3560/community/addLikeData/".concat(t,"/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("데이터베이스에 좋아요 정보 추가에 실패했습니다.");console.log("데이터베이스에 좋아요 정보를 추가했습니다."),r.map(e=>(e.postId===t&&(e.likeCount=String(Number(e.likeCount)+1)),e)),l({...a,[t]:!0})}catch(e){console.error("데이터베이스에 좋아요 정보 추가 중 오류가 발생했습니다:",e)}}else window.confirm("로그인이 필요합니다. 로그인 페이지로 이동하시겠습니까?")&&(window.location.href="/login")};return(0,s.jsx)("button",{className:"w-1/2 border",onClick:i,children:a[t]?"좋아해요!":"좋아요!"})},h=e=>{let{post:t,currentuser:n,onDeleteComment:o}=e;if(!t.commentContents||!t.commentDates||!t.commentuserId||!t.commentIndexes)return null;{let e=t.commentContents.split(","),c=t.commentDates.split(","),r=t.commentuserId.split(","),a=t.commentIndexes.split(",").map(Number),l=c.map(e=>{let t=e.split(":");return t.length>2?t.slice(0,t.length-1).join(":"):e}),i=(e,t)=>{o(e,t)};return(0,s.jsx)("div",{children:e.map((e,o)=>(0,s.jsx)("div",{children:(0,s.jsxs)("p",{children:[r[o],": ",e," ",l[o],n===r[o]&&(0,s.jsx)("button",{className:"border text-white rounded",onClick:()=>i(t.postId,a[o]),children:"삭제"})]})},o))})}},x=e=>{let{postId:t,value:n,onChange:o,onSubmit:c}=e;return(0,s.jsxs)("div",{className:"flex border-2",children:[(0,s.jsx)("input",{className:"w-1/2 text-black",type:"text",placeholder:"댓글을 입력하세요",value:n,onChange:e=>o(e.target.value)}),(0,s.jsx)("div",{className:"w-1/2 flex justify-center",children:(0,s.jsx)("button",{className:"",onClick:c,children:"댓글달기"})})]})},p=e=>{let{postdata:t,userId:n,likedata:c,handleRegisterFeed:a}=e,l=e=>n===e,[d,p]=(0,o.useState)({}),[f,j]=(0,o.useState)({}),[w,g]=(0,o.useState)({}),[y,v]=(0,o.useState)({}),[I,N]=(0,o.useState)({}),b=(e,t)=>{j({...f,[e]:t})},C=e=>{N({...I,[e]:!I[e]}),I[e]||j({...f,[e]:""})},k=async e=>{try{if(!f[e]){alert("댓글을 입력하세요!");return}if(!n){window.confirm("로그인이 필요합니다. 로그인 페이지로 이동하시겠습니까?")&&(window.location.href="/login");return}let s=await fetch("http://localhost:3560/community/addComment/".concat(e,"/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commentcontent:f[e]})});if(!s.ok)throw Error("댓글을 추가하는데 실패했습니다.");let o=await s.json();t.map(t=>{if(t.postId===e){let s=t.commentContents?"".concat(t.commentContents,",").concat(f[e]):f[e];t.commentContents=s;let c=t.commentuserId?"".concat(t.commentuserId,",").concat(n):n;t.commentuserId=c;let r=new Date,a="".concat(r.getFullYear(),"-").concat(r.getMonth()+1,"-").concat(r.getDate()," ").concat(r.getHours(),":").concat(10>r.getMinutes()?"0"+r.getMinutes():r.getMinutes()),l=t.commentDates?"".concat(t.commentDates,",").concat(a):a;t.commentDates=l;let i=t.commentIndexes?"".concat(t.commentIndexes,",").concat(o.commentIndex):"".concat(o.commentIndex);t.commentIndexes=i}return t}),j({...f,[e]:""})}catch(e){console.error("댓글 추가 중 오류가 발생했습니다:",e)}},S=async(e,n)=>{try{if(!window.confirm("정말로 댓글을 삭제하시겠습니까?"))return;if(!(await fetch("http://localhost:3560/community/deleteComment/".concat(e,"/").concat(n),{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw Error("댓글 삭제에 실패했습니다.");alert("댓글을 삭제했습니다."),window.location.reload(),t.map(t=>{if(t.postId===e){var s,o,c;let e=(null===(s=t.commentContents)||void 0===s?void 0:s.split(","))||[],r=(null===(o=t.commentDates)||void 0===o?void 0:o.split(","))||[],a=(null===(c=t.commentuserId)||void 0===c?void 0:c.split(","))||[];e.splice(n,1),r.splice(n,1),a.splice(n,1),t.commentContents=e.join(","),t.commentDates=r.join(","),t.commentuserId=a.join(",")}return t})}catch(e){console.error("댓글 삭제 중 오류가 발생했습니다:",e)}};return(0,s.jsxs)("div",{className:"instagram-main flex flex-col items-center w-3/5 mt-5 mb-5",children:[(0,s.jsx)(r,{handleRegisterFeed:a}),(0,s.jsx)("div",{className:"feed w-full",children:t.slice(0).reverse().map((e,o)=>(0,s.jsxs)("div",{className:"w-1/2 border",children:[(0,s.jsx)("div",{className:"border",children:(0,s.jsx)(i,{postId:e.postId,postUserId:e.userId,postDate:e.date,isAuthor:()=>l(e.userId)})}),(0,s.jsx)(m,{content:e.content,imgurl:e.imgurl}),(0,s.jsxs)("div",{children:[e.likeCount,"명이 좋아해요!"]}),(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsx)(u,{postId:e.postId,userId:n,likedata:c,postdata:t,likeStatus:d,setLikeStatus:p}),(0,s.jsx)("button",{className:"w-1/2 border",onClick:()=>C(e.postId),children:I[e.postId]?"댓글닫기 (".concat(e.commentContents?e.commentContents.split(",").length:0,")"):"댓글열기 (".concat(e.commentContents?e.commentContents.split(",").length:0,")")}),I[e.postId]&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:e.commentContents&&(0,s.jsx)(h,{onDeleteComment:S,post:e,currentuser:n})}),(0,s.jsx)(x,{postId:e.postId,value:f[e.postId]||"",onChange:t=>b(e.postId,t),onSubmit:()=>k(e.postId)})]})]})]},o))})]})},f=n(47907),j=()=>{let[e,t]=(0,o.useState)([]),[n,c]=(0,o.useState)(null),[r,a]=(0,o.useState)([]),[l,i]=(0,o.useState)(!1),d=(0,f.useSearchParams)();return(0,o.useEffect)(()=>{(async()=>{try{let e=d.get("query"),n="http://localhost:3560/community/postData";e&&(n+="?query=".concat(e));let s=await fetch(n),o=await s.json();if(!Array.isArray(o))throw Error("데이터 형식 오류: 배열이 아닙니다.");console.log(o),t(o)}catch(e){console.error("데이터를 불러오는 동안 에러발생:",e)}})()},[d,l]),(0,o.useEffect)(()=>{let e=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("토큰이 없습니다.");let t=await fetch("http://localhost:3560/userId",{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("사용자 정보를 불러오는데 실패했습니다.");let n=await t.json();n.length>0&&c(n[0].userId)}catch(e){console.error("유저 정보를 불러오는 동안 에러가 발생했습니다:",e)}};n||e()},[n]),(0,o.useEffect)(()=>{(async()=>{try{let e=await fetch("http://localhost:3560/community/likeData"),t=await e.json();if(!Array.isArray(t))throw Error("데이터 형식 오류: 배열이 아닙니다.");a(t)}catch(e){console.error("데이터를 불러오는 동안 에러발생:",e)}})()},[]),(0,s.jsx)("div",{className:"w-screen h-[86vh] flex justify-center",children:(0,s.jsx)(o.Suspense,{fallback:(0,s.jsx)("div",{className:"text-white",children:"Loading..."}),children:(0,s.jsx)(p,{postdata:e,userId:n,likedata:r,handleRegisterFeed:()=>{localStorage.getItem("token")?window.location.href="/community/registerfeed":(alert("로그인이 필요합니다."),window.location.href="/login")}})})})}},15074:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}});var s=n(3827),o=n(42685),c=n(47907),r=n(38648);function a(e){var t;let{placeholder:n}=e,a=(0,c.useSearchParams)(),l=(0,c.usePathname)(),{replace:i}=(0,c.useRouter)(),d=(0,r.y1)(e=>{let t=new URLSearchParams(a);e?t.set("query",e):t.delete("query"),i("".concat(l,"?").concat(t.toString()))},300);return(0,s.jsxs)("div",{className:"relative flex flex-1 flex-shrink-0",children:[(0,s.jsx)("label",{htmlFor:"search",className:"sr-only",children:"Search"}),(0,s.jsx)("input",{className:"peer block w-full rounded-md border border-gray-200 py-[9px] pl-10 text-sm text-gray-500 outline-2 placeholder:text-gray-500",placeholder:n,onChange:e=>{d(e.target.value)},defaultValue:null===(t=a.get("query"))||void 0===t?void 0:t.toString()}),(0,s.jsx)(o.Z,{className:"absolute left-3 top-1/2 h-[18px] w-[18px] -translate-y-1/2 text-gray-500 peer-focus:text-gray-900"})]})}},59667:function(){}},function(e){e.O(0,[792,654,971,69,744],function(){return e(e.s=60748)}),_N_E=e.O()}]);